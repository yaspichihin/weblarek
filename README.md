# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn dev
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Данные

### Интерфейсы

#### Продукт

```ts
interface IProduct {
  id: string;
  title: string;
  image: string;
  category: string;
  price: number | null;
  description: string;
}
```

#### Покупатель

```ts
type TPayment = "card" | "cash" | "";

interface IBuyer {
  payment: TPayment;
  address: string;
  email: string;
  phone: string;
}

// Интерфейс для валидации ошибок в классе Buyer
export type IValidationErrors = Partial<IBuyer>;
```

#### ApiService

```ts
// Запрос на создание заказа
import { IBuyer } from "./index";

interface IOrder extends IBuyer {
  total: number;
  items: string[];
}

// Ответ на создание заказа
interface IOrderResponse {
  id: string;
  total: number;
}
```

## Модели данных

### Каталог товаров

```
class ProductCatalog {

  // Получение массива товаров
  getProducts() ...

  // Сохранение массива товаров
  setProducts(newCatalog) ...

  // Получение товара для подробного отображения
  getSelectedProduct() ...

  // Сохранение товара для подробного отображения
  setSelectedProduct(newProduct) ...

  // Получение одного товара по его id
  getProduct(productId) ...
}
```

### Корзина

```
class Cart {

  // Получение массива товаров, которые находятся в корзине
  getProducts() ...

  // Добавление товара в массив корзины
  addProduct(product) ...

  // Удаление товара из массива корзины;
  removeProduct(product) ...

  // Очистка корзины
  clearCart() ...

  // Получение количества товаров в корзине
  getCartLength() ...

  // Получение стоимости всех товаров в корзине
  getCartPrice(): ...

  // Проверка наличия товара в корзине по его id
  isProductInCart(productId) ...
}
```

### Покупатель

```
class Buyer {

  // Установка атрибута типа оплаты
  setPayment(newPayment) ...

  // Установка атрибута адрес
  setAddress(newAddress) ...

  // Установка атрибута email
  setEmail(newEmail) ...

  // Установка атрибута телефон
  setPhone(newPhone) ...

  // Получение всех данных покупателя
  getBuyerInfo() ...

  // Очистка данных покупателя
  clearBuyerInfo() ...

  // Валидация атрибутов покупателя
  validate() ...
}
```

## Слой коммуникации

```
class ApiService {

  // Композиция API
  constructor(api) ...

  // Получить продукты
  getProducts(): ...

  // Создать заказ
  postOrder(orderData): ...
}
```

## Слой Представления (View)

### Header

**Назначение:** Шапка сайта с кнопкой корзины и счетчиком товаров.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)`

**Поля:**

- `_basketButton: HTMLButtonElement` - кнопка открытия корзины
- `_counter: HTMLElement` - элемент отображения счетчика товаров

**Методы:**

- `set counter(value: number)` - устанавливает количество товаров в корзине

**События:**

- `basket:open` - генерируется при клике на кнопку корзины

---

### Modal

**Назначение:** Универсальное модальное окно для отображения различного контента.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)`

**Поля:**

- `_closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `_content: HTMLElement` - контейнер для содержимого модального окна

**Методы:**

- `set content(value: HTMLElement)` - устанавливает содержимое модального окна
- `open(): void` - открывает модальное окно (добавляет класс `modal_active`)
- `close(): void` - закрывает модальное окно (удаляет класс `modal_active`)
- `render(data: ModalData): HTMLElement` - устанавливает содержимое и открывает модальное окно

**События:**

- `modal:open` - генерируется при открытии модального окна
- `modal:close` - генерируется при закрытии (по клику на крестик, overlay или Escape)

**Особенности:**

- Закрывается по нажатию Escape
- Закрывается по клику вне области контента
- Автоматически устанавливает фокус при открытии
- Блокирует прокрутку страницы через CSS (`.page:has(.modal_active)`)

---

### Gallery

**Назначение:** Галерея товаров на главной странице.

**Конструктор:**  
`constructor(container: HTMLElement)`

**Методы:**

- `set catalog(items: HTMLElement[])` - устанавливает список карточек товаров для отображения

**Особенности:**

- Использует метод `replaceChildren()` для обновления содержимого
- Не генерирует события (события генерируют дочерние карточки)

---

### Basket

**Назначение:** Корзина с товарами и кнопкой оформления заказа.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)`

**Поля:**

- `_list: HTMLElement` - список товаров в корзине
- `_total: HTMLElement` - элемент отображения общей стоимости
- `_button: HTMLButtonElement` - кнопка "Оформить"

**Методы:**

- `set items(items: HTMLElement[])` - устанавливает список карточек товаров, автоматически блокирует кнопку если список пуст
- `set total(value: number)` - устанавливает общую стоимость товаров (добавляет текст "синапсов")

**События:**

- `basket:order` - генерируется при клике на кнопку "Оформить"

**Особенности:**

- Автоматически блокирует кнопку "Оформить" если корзина пуста
- Отображает "Корзина пуста" через CSS если список товаров пуст

---

### Success

**Назначение:** Экран успешного оформления заказа.

**Конструктор:**  
`constructor(container: HTMLElement, events: IEvents)`

**Поля:**

- `_total: HTMLElement` - элемент отображения итоговой суммы заказа
- `_closeButton: HTMLButtonElement` - кнопка "За новыми покупками!"

**Методы:**

- `set total(value: number)` - устанавливает итоговую сумму (формат: "Списано N синапсов")

**События:**

- `success:close` - генерируется при клике на кнопку закрытия

---

### Card (базовый класс, abstract)

**Назначение:** Базовый абстрактный класс для всех типов карточек товара. Содержит общий функционал.

**Generic параметр:** `Card<T extends CardData>`

**Конструктор:**  
`constructor(container: HTMLElement)`

**Поля:**

- `_id: string` - идентификатор товара
- `_title: HTMLElement` - элемент названия товара
- `_price: HTMLElement` - элемент цены товара

**Методы:**

- `set id(value: string)` - устанавливает ID товара
- `set title(value: string)` - устанавливает название товара
- `set price(value: string | null)` - устанавливает цену, для `null` отображает "Бесценно"

**Наследники:** CardCatalog, CardPreview, CardBasket

---

### CardCatalog extends Card\<CardCatalogData\>

**Назначение:** Карточка товара в каталоге на главной странице.

**Конструктор:**  
`constructor(container: HTMLElement, actions?: { onClick?: () => void })`

**Дополнительные поля:**

- `_image: HTMLImageElement` - изображение товара
- `_category: HTMLElement` - категория товара

**Дополнительные методы:**

- `set image(value: string)` - устанавливает изображение (автоматически добавляет CDN_URL)
- `set category(value: string)` - устанавливает категорию и применяет CSS модификатор из `categoryMap`

**Callback:**

- `onClick` - вызывается при клике на карточку

**Особенности:**

- Автоматически применяет CSS модификаторы категорий (`card__category_soft`, `card__category_hard`, и т.д.)
- Использует константу `CDN_URL` для формирования полного пути к изображению

---

### CardPreview extends Card\<CardPreviewData\>

**Назначение:** Полная карточка товара с описанием, отображается в модальном окне.

**Конструктор:**  
`constructor(container: HTMLElement, actions?: { onClick?: () => void })`

**Дополнительные поля:**

- `_image: HTMLImageElement` - изображение товара
- `_category: HTMLElement` - категория товара
- `_description: HTMLElement` - описание товара
- `_button: HTMLButtonElement` - кнопка действия ("В корзину"/"Удалить")

**Дополнительные методы:**

- `set image(value: string)` - устанавливает изображение
- `set category(value: string)` - устанавливает категорию с CSS модификатором
- `set description(value: string)` - устанавливает описание товара
- `set buttonText(value: string)` - устанавливает текст кнопки
- `set buttonDisabled(value: boolean)` - блокирует/разблокирует кнопку

**Callback:**

- `onClick` - вызывается при клике на кнопку действия

**Особенности:**

- Кнопка блокируется для товаров без цены с текстом "Недоступно"

---

### CardBasket extends Card\<CardBasketData\>

**Назначение:** Компактная карточка товара в корзине.

**Конструктор:**  
`constructor(container: HTMLElement, actions?: { onDelete?: () => void })`

**Дополнительные поля:**

- `_index: HTMLElement` - порядковый номер товара в списке
- `_deleteButton: HTMLButtonElement` - кнопка удаления

**Дополнительные методы:**

- `set index(value: number)` - устанавливает порядковый номер

**Callback:**

- `onDelete` - вызывается при клике на кнопку удаления

**Особенности:**

- Не содержит изображение и категорию (компактная версия)

---

### Form (базовый класс, abstract)

**Назначение:** Базовый абстрактный класс для всех форм. Содержит общий функционал работы с формами.

**Generic параметр:** `Form<T extends FormData>`

**Конструктор:**  
`constructor(container: HTMLFormElement, events: IEvents)`

**Поля:**

- `_submit: HTMLButtonElement` - кнопка отправки формы
- `_errors: HTMLElement` - элемент отображения ошибок валидации

**Методы:**

- `set valid(value: boolean)` - устанавливает валидность формы (блокирует/разблокирует кнопку отправки)
- `set errors(value: string[])` - устанавливает массив сообщений об ошибках (объединяет через запятую)

**События:**

- `{formName}:submit` - генерируется при отправке формы (используется `name` атрибут формы)

**Особенности:**

- Автоматически предотвращает стандартное поведение формы (`preventDefault`)
- Динамическое имя события основано на атрибуте `name` формы

**Наследники:** OrderForm, ContactsForm

---

### OrderForm extends Form\<OrderFormData\>

**Назначение:** Форма выбора способа оплаты и адреса доставки (первый шаг оформления).

**Конструктор:**  
`constructor(container: HTMLFormElement, events: IEvents)`

**Дополнительные поля:**

- `_paymentButtons: HTMLButtonElement[]` - массив кнопок выбора оплаты (Онлайн/При получении)
- `_addressInput: HTMLInputElement` - поле ввода адреса доставки

**Дополнительные методы:**

- `set payment(value: 'card' | 'cash')` - устанавливает выбранный способ оплаты (добавляет класс `button_alt-active`)
- `set address(value: string)` - устанавливает значение адреса

**События:**

- `order:payment` - генерируется при выборе способа оплаты, передает `{ payment: string }`
- `order:address` - генерируется при вводе адреса, передает `{ address: string }`
- `order:submit` - генерируется при отправке формы (кнопка "Далее")

**Особенности:**

- Использует CSS модификатор `button_alt-active` для выделения выбранного способа оплаты
- Автоматически переключает активную кнопку при смене способа оплаты

---

### ContactsForm extends Form\<ContactsFormData\>

**Назначение:** Форма ввода email и телефона покупателя (второй шаг оформления).

**Конструктор:**  
`constructor(container: HTMLFormElement, events: IEvents)`

**Дополнительные поля:**

- `_emailInput: HTMLInputElement` - поле ввода email
- `_phoneInput: HTMLInputElement` - поле ввода телефона

**Дополнительные методы:**

- `set email(value: string)` - устанавливает значение email
- `set phone(value: string)` - устанавливает значение телефона

**События:**

- `contacts:email` - генерируется при вводе email, передает `{ email: string }`
- `contacts:phone` - генерируется при вводе телефона, передает `{ phone: string }`
- `contacts:submit` - генерируется при отправке формы (кнопка "Оплатить")

**Особенности:**

- Real-time валидация при каждом изменении поля
- События генерируются при каждом вводе символа

---

## События приложения

### События от Моделей данных

Модели генерируют события при изменении своего состояния.

#### `products:changed`

**Источник:** `Products.setProducts()`  
**Когда:** Загружен каталог товаров с сервера  
**Данные:** `{ products: IProduct[] }`  
**Обработка:** Обработчик получает товары через products.getProducts(), создает для каждого карточку CardCatalog и отображает в gallery

---

#### `product:selected`

**Источник:** `Products.setSelectedProduct()`  
**Когда:** Выбран или очищен товар для просмотра  
**Данные:** `{ product: IProduct | null }`  
**Обработка:** Создание и отображение CardPreview с детальной информацией о товаре в модальном окне

---

#### `cart:changed`

**Источник:** `Cart.addProduct()`, `Cart.removeProduct()`, `Cart.clearCart()`  
**Когда:** Изменяется состав корзины (добавление, удаление, очистка товаров)  
**Данные:** нет  
**Обработка:** Обработчик автоматически обновляет счетчик в Header через cart.getCartLength()

---

#### `buyer:changed`

**Источник:** Buyer.setPayment(), Buyer.setAddress(), Buyer.setEmail(), Buyer.setPhone(), Buyer.clearBuyerInfo()  
**Когда:** Изменяются данные покупателя (любое поле)  
**Данные:** `{ field: string }` - название измененного поля ('payment', 'address', 'email', 'phone', или 'all' при очистке)  
**Обработка:** Обработчик получает данные из модели (buyer.getBuyerInfo()), вызывает валидацию (buyer.validate()) и перерисовывает соответствующую форму через render() с актуальными данными и состоянием валидации

---

### События от View компонентов

View компоненты генерируют события в ответ на действия пользователя.

#### `modal:open`

**Источник:** `Modal.open()`  
**Когда:** Модальное окно открывается  
**Данные:** нет  
**Обработка:** Можно использовать для аналитики или дополнительной логики

---

#### `modal:close`

**Источник:** `Modal.close()`  
**Когда:** Модальное окно закрывается (крестик, overlay, Escape)  
**Данные:** нет  
**Обработка:** Очистка выбранного товара (`products.setSelectedProduct(null)`)

---

#### `basket:open`

**Источник:** Header (клик на кнопку корзины)  
**Когда:** Пользователь открывает корзину  
**Данные:** нет  
**Обработка:** Создание и отображение компонента Basket с текущими товарами

---

#### `card:select`

**Источник:** CardCatalog (через callback)  
**Когда:** Пользователь кликает на карточку товара в каталоге  
**Данные:** `{ id: string }`  
**Обработка:** Получение товара по ID и сохранение в модель через products.setSelectedProduct(), что генерирует событие product:selected

---

#### `card:add`

**Источник:** CardPreview (через callback)  
**Когда:** Пользователь нажимает "В корзину"  
**Данные:** `{ id: string }`  
**Обработка:** Добавление товара в корзину, обновление счетчика, закрытие модального окна

---

#### `card:remove`

**Источник:** CardPreview или CardBasket (через callback)  
**Когда:** Пользователь удаляет товар из корзины  
**Данные:** `{ id: string }`  
**Обработка:** Удаление товара из корзины, обновление счетчика, обновление/закрытие модального окна

---

#### `basket:order`

**Источник:** Basket (клик на "Оформить")  
**Когда:** Пользователь начинает оформление заказа  
**Данные:** нет  
**Обработка:** Открытие формы OrderForm

---

#### `order:payment`

**Источник:** OrderForm (клик на кнопку оплаты)  
**Когда:** Пользователь выбирает способ оплаты  
**Данные:** `{ payment: string }` ('card' или 'cash')  
**Обработка:** Сохранение в модель Buyer через buyer.setPayment(), что генерирует событие buyer:changed

---

#### `order:address`

**Источник:** OrderForm (ввод в поле адреса)  
**Когда:** Пользователь вводит адрес доставки  
**Данные:** `{ address: string }`  
**Обработка:** Сохранение в модель Buyer через buyer.setAddress(), что генерирует событие buyer:changed

---

#### `order:submit`

**Источник:** OrderForm (отправка формы, кнопка "Далее")  
**Когда:** Пользователь завершает первый шаг оформления  
**Данные:** нет  
**Обработка:** Открытие формы ContactsForm

---

#### `contacts:email`

**Источник:** ContactsForm (ввод в поле email)  
**Когда:** Пользователь вводит email  
**Данные:** `{ email: string }`  
**Обработка:** Сохранение в модель Buyer через buyer.setEmail(), что генерирует событие buyer:changed

---

#### `contacts:phone`

**Источник:** ContactsForm (ввод в поле телефона)  
**Когда:** Пользователь вводит телефон  
**Данные:** `{ phone: string }`  
**Обработка:** Сохранение в модель Buyer через buyer.setPhone(), что генерирует событие buyer:changed

---

#### `contacts:submit`

**Источник:** ContactsForm (отправка формы, кнопка "Оплатить")  
**Когда:** Пользователь завершает оформление заказа  
**Данные:** нет  
**Обработка:** Отправка заказа на сервер, при успешном ответе очистка корзины и данных покупателя, отображение Success экрана с итоговой суммой из ответа сервера

---

#### `success:close`

**Источник:** Success (клик на "За новыми покупками!")  
**Когда:** Пользователь закрывает экран успешного заказа  
**Данные:** нет  
**Обработка:** Закрытие модального окна (корзина и данные покупателя уже очищены после успешного ответа сервера)

---

### Потоки событий

#### Оформление заказа (полный цикл):

```
basket:open
→ Отображение корзины

basket:order
→ Получение данных из buyer.getBuyerInfo() и buyer.validate()
→ Открытие OrderForm с актуальными данными и валидацией

order:payment + order:address
→ buyer.setPayment/setAddress → buyer:changed (field: 'payment'/'address')
→ Обработчик buyer:changed получает данные, валидирует, перерисовывает форму через render()
→ Активация/деактивация кнопки "Далее" в зависимости от валидности

order:submit
→ Получение данных из buyer.getBuyerInfo() и buyer.validate()
→ Открытие ContactsForm с актуальными данными и валидацией

contacts:email + contacts:phone
→ buyer.setEmail/setPhone → buyer:changed (field: 'email'/'phone')
→ Обработчик buyer:changed получает данные, валидирует, перерисовывает форму через render()
→ Активация/деактивация кнопки "Оплатить" в зависимости от валидности

contacts:submit
→ API запрос с данными заказа
→ При успешном ответе: cart.clearCart() и buyer.clearBuyerInfo()
→ Отображение Success экрана с total из ответа сервера

success:close или modal:close
→ Закрытие модального окна
→ Корзина уже пуста, header обновлен
```

#### Добавление товара в корзину:

```
card:select
→ products.setSelectedProduct() → product:selected
→ Открытие CardPreview

card:add
→ cart.addProduct() → cart:changed
→ Автоматическое обновление счетчика
→ modal:close
```

---

### Валидация форм

Валидация происходит в режиме реального времени:

1. Пользователь изменяет поле → событие `{form}:{field}` (например, `order:address`)
2. Presenter обновляет модель → `buyer.set{Field}()` (например, `buyer.setAddress()`)
3. Модель генерирует событие → `buyer:changed` с параметром `{ field: 'fieldName' }`
4. Обработчик `buyer:changed` выполняет:
   - Получает актуальные данные: `buyer.getBuyerInfo()`
   - Запускает валидацию: `buyer.validate()`
   - Определяет валидность и формирует сообщения об ошибках
   - Перерисовывает соответствующую форму через `render()` с новыми данными и состоянием валидации
5. View обновляет форму → устанавливает данные в поля, блокирует/разблокирует кнопку, показывает ошибки

## Presenter (Логика приложения)

Presenter реализован в файле `main.ts` без выделения в отдельный класс.

**Назначение:** Связывает модели данных и представления, обрабатывает все события приложения, координирует взаимодействие между слоями.

**Основные компоненты:**

- `events: EventEmitter` - брокер событий для связи компонентов
- `products: Products` - модель каталога товаров
- `cart: Cart` - модель корзины
- `buyer: Buyer` - модель данных покупателя
- `header: Header` - компонент шапки
- `modal: Modal` - компонент модального окна
- `gallery: Gallery` - компонент галереи
- `orderForm: OrderForm` - форма заказа (создается один раз, переиспользуется)
- `contactsForm: ContactsForm` - форма контактов (создается один раз, переиспользуется)

**Основной поток:**

1. `init()` - загрузка данных с API
2. Создание компонентов View (включая формы - один раз)
3. Обработка событий от моделей и представлений
4. Координация взаимодействия между компонентами
5. Валидация форм в реальном времени через событие buyer:changed
6. Отправка заказа на сервер

**Особенности реализации:**

- Все события обрабатываются в одном месте
- Формы создаются один раз и переиспользуются через метод render()
- Валидация происходит при каждом изменении поля через событие buyer:changed
- Обработчик buyer:changed получает данные из модели, валидирует и перерисовывает форму
- Использует callback pattern для карточек (передача ID через замыкание)
- Темплейты клонируются для компонентов, создаваемых динамически (карточки, корзина)
- Корзина и данные покупателя очищаются сразу после успешного ответа сервера, а не при закрытии окна успеха

## Архитектурные особенности View слоя

### Принципы реализации:

1. **Не хранят данные** - View компоненты содержат только ссылки на DOM элементы, данные хранятся в моделях
2. **Не содержат логику** - компоненты только отображают данные и генерируют события
3. **Не изменяют свое состояние** - View пассивны, данные приходят из моделей через Presenter
4. **Элементы находятся в конструкторе** - все DOM элементы ищутся один раз при создании и сохраняются в поля
5. **Слушатели в конструкторе** - все обработчики событий устанавливаются один раз при создании
6. **Метод render()** - принимает данные, устанавливает их через setter'ы и возвращает HTMLElement (корневой элемент компонента)
7. **Источник истины - модель** - формы всегда отображают данные из модели, полученные через getBuyerInfo()

### Паттерны взаимодействия:

**Callback pattern** - используется для карточек товаров:

```
const card = new CardCatalog(container, {
  onClick: () => events.emit('card:select', { id: product.id })
});
```

**Event Emitter** - используется для компонентов без привязки к данным:

```
this._basketButton.addEventListener('click', () => {
  this.events.emit('basket:open');
});
```

**Иерархия наследования:**

```
Component<T> (abstract)
├── Header
├── Modal
├── Gallery
├── Basket
├── Success
├── Card<T> (abstract)
│   ├── CardCatalog
│   ├── CardPreview
│   └── CardBasket
└── Form<T> (abstract)
    ├── OrderForm
    └── ContactsForm
```
